asyncapi: 2.2.0
info:
  title: FFC Pay Processing
  version: '1.0.0'
channels:
  ffc-pay-processing:
    subscribe:
      message:
        $ref: '#/components/messages/PaymentRequest'
  ffc-pay-submit:
    publish:
      message:
        $ref: '#/components/messages/PaymentRequest'
  ffc-pay-debt-data:
    publish:
      message:
        $ref: '#/components/messages/PaymentRequest'
  ffc-pay-manual-ledger-check:
    subscribe:
      message:
        $ref: '#/components/messages/PaymentRequest'
  ffc-pay-quality-check:
    publish:
      message:
        $ref: '#/components/messages/ManualLedgerCheck'
  ffc-pay-acknowledgement:
    subscribe:
      message:
        $ref: '#/components/messages/Acknowledgement'
  ffc-pay-return:
    subscribe:
      message:
        $ref: '#/components/messages/Return'
components:
  messages:
    PaymentRequest:
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PaymentRequest'
    ManualLedgerCheck:
      contentType: application/json
      payload:
        type: object
        properties:
          deltaPaymentRequest:
            $ref: '#/components/schemas/PaymentRequest'
          completedPaymentRequests:
            type: array
            description: Payment request after both delta calculations and automated ledger assignment
            payload:
              $ref: '#/components/schemas/PaymentRequest'
    Acknowledgement:
      contentType: application/json
      payload:
        $ref: '#/components/schemas/Acknowledgement'
    Return:
      contentType: application/json
      payload:
        $ref: '#/components/schemas/Return'
  schemas:
    PaymentRequest:
      type: object
      properties:
        sourceSystem:
          $ref: '#/components/schemas/SourceSystem'
        sbi:
          $ref: '#/components/schemas/Sbi'
        frn:
          $ref: '#/components/schemas/Frn'
        marketingYear:
          $ref: '#/components/schemas/MarketingYear'
        paymentRequestNumber:
          $ref: '#/components/schemas/PaymentRequestNumber'
        correlationId:
          $ref: '#/components/schemas/CorrelationId'
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'
        agreementNumber:
          $ref: '#/components/schemas/AgreementNumber'
        contractNumber:
          $ref: '#/components/schemas/ContractNumber'
        currency:
          $ref: '#/components/schemas/Currency'
        schedule:
          $ref: '#/components/schemas/Schedule'
        dueDate:
          $ref: '#/components/schemas/DueDate'
        value:
          $ref: '#/components/schemas/Value'
        schemeId:
          $ref: '#/components/schemas/SchemeId'
        ledger:
          $ref: '#/components/schemas/Ledger'
        deliveryBody:
          $ref: '#/components/schemas/DeliveryBody'
        debtType:
          $ref: '#/components/schemas/DebtType'
        recoveryDate:
          $ref: '#/components/schemas/RecoveryDate'
        originalSettlementDate:
          $ref: '#/components/schemas/OriginalSettlementDate'
        originalInvoiceNumber:
          $ref: '#/components/schemas/OriginalInvoiceNumber'
        invoiceCorrectionReference:
          $ref: '#/components/schemas/InvoiceCorrectionReference'
        referenceId:
          $ref: '#/components/schemas/ReferenceId'
        invoiceLines:
          $ref: '#/components/schemas/InvoiceLines'
    InvoiceLines:
      type: array
      description: List of Invoice lines that make up request
      items:
        type: object
        properties:
          description:
            $ref: '#/components/schemas/Description'
          value:
            $ref: '#/components/schemas/Value'
          schemeCode:
            $ref: '#/components/schemas/SchemeCode'
          fundCode:
            $ref: '#/components/schemas/FundCode'
          accountCode:
            $ref: '#/components/schemas/AccountCode'
    Acknowledgement:
      properties:
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'
        frn:
          $ref: '#/components/schemas/Frn'
        success:
          $ref: '#/components/schemas/Success'
        acknowledged:
          $ref: '#/components/schemas/Acknowledged'
        message:
          $ref: '#/components/schemas/Message'
    Return:
      properties:
        sourceSystem:
          $ref: '#/components/schemas/SourceSystem'
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'
        frn:
          $ref: '#/components/schemas/Frn'
        postedDate:
          $ref: '#/components/schemas/PostedDate'
        currency:
          $ref: '#/components/schemas/Currency'
        value:
          $ref: '#/components/schemas/Value'
        reference:
          $ref: '#/components/schemas/Reference'
        settled:
          $ref: '#/components/schemas/Settled'
        detail:
          $ref: '#/components/schemas/Detail'
    SourceSystem:
      type: string
      description: System identifier request originates from
    Sbi:
      type: number
      description: Single Business Identifier, optional
    Frn:
      type: number
      description: Firm Reference Number
    MarketingYear:
      type: number
      description: Scheme year for request
    PaymentRequestNumber:
      type: number
      description: Version of payment request starting with 1, anything greater than 1 is an adjustment
    CorrelationId:
      type: string
      description: Identifier for event correlation  
    InvoiceNumber:
      type: string
      description: Unique request for payment
    AgreementNumber:
      type: string
      description: Unique reference number for agreement/application
    ContractNumber:
      type: string
      description: Contract reference number of agreement
    Currency:
      type: string
      description: Currency of values in request, eg GBP
    Schedule:
      type: string
      description: Payment frequency instruction for DAX.  These codes are pre-configured in DAX and have an underlying schedule coded to them.  Valid codes Q4, M12, T4
    DueDate:
      type: string
      description: Date request should be issued from DAX in format DD/MM/YYYY
    Value:
      type: number
      description: Integer net value of request, ie sum of all invoice lines
    SchemeId:
      type: number
      description: Unique ID for scheme
    Ledger:
      type: string
      description: Target ledger for settlement, AP for Accounts Payable and AR for Accounts Receivable
    DeliveryBody:
      type: string
      description: Delivery body responsible for payment
    DebtType:
      type: string
      description: Reason for recovery, optional
    RecoveryDate:
      type: string
      description: Date recovery identified, optional
    OriginalSettlementDate:
      type: string
      description: Date original invoice settled, optional
    OriginalInvoiceNumber:
      type: string
      description: Original invoice number, optional
    InvoiceCorrectionReference:
      type: string
      description: Original invoice number if correction to AR
    ReferenceId:
      type: string
      description: Optional UUID used for duplicate detection.  If not provided InvoiceNumber is used instead    
    Description:
      type: string
      description: Description of what line relates to, eg gross or penalty
    SchemeCode:
      type: string
      description: Unique scheme code for funding option
    FundCode:
      type: string
      description: Unique fund code to pay from
    AccountCode:
      type: string
      description: Unique account code to pay from
    Success:
      type: boolean
      description: Whether request was successfully loaded by DAX, required
    Acknowledged:
      type: string
      description: Date acknowledged in DAX, required
    Message:
      type: string
      description: Reason for DAX load failure, optional
    PostedDate:
      type: string
      description: Date posted in DAX
    Reference:
      type: string
      description: DAX reference for settlement
    Settled:
      type: boolean
      description: Whether request was successfully settled
    Detail:
      type: string
      description: Additional settlement information from DAX, optional
